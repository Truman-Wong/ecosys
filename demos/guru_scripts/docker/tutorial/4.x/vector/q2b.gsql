USE GRAPH financialGraph

CREATE OR REPLACE QUERY q2b (string accntName) SYNTAX v3 {

  SumAccum<int> @totalTransfer = 0;

  v = SELECT b
      FROM (a:Account {name: accntName})-[e:transfer]->(b:Account)
      WHERE gds.vector.distance(b.emb1, a.emb1, "COSINE") < 1.0
      ACCUM  b.@totalTransfer += e.amount;

  PRINT v WITH_EMBEDDING;

}

#compile and install the query as a stored procedure
install query -single q2b

#run the query
run query q2b("Scott")
